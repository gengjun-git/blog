### 红黑树《算法导论》

#### 特性
 1. 节点的颜色是红色或者黑色
 2. 根节点是黑色
 3. 所有的叶子节点都为黑色
 4. 如果一个节点的颜色为红色，那么他的子节点都为黑色
 5. 对于任意一节点，所有从该节点到叶子节点的路径上，黑色节点的数量都是相同的

#### 定理
*红黑数的高度最大为2 × lg(n+1)*
	证明：

	定义x节点的black-height为：从x节点(不包括)到叶子的路径上，黑色节点数。用bh(x)标示。非叶子节点称为内部节点，内部节点存有key值。那么以x为根的树至少有2^bh(x) - 1个内部节点，归纳法证明如下

	当x的高度为0时，此时x必为叶子节点，该树含有最多2^0 - 1 = 0个内部节点；

	当x的高度大于0时，此时x为内部节点，必有左右孩子。由于x孩子的black-height为hb(x)或者hb(x)-1，那么x的孩子节点至少含有2^(bh(x)-1) - 1个内部节点；则x至少含有2^(bh(x)-1) - 1 + 2^(bh(x)-1) -1 + 1 = 2^bh(x) - 1个内部节点

	根据特性4可知bh(x) >= h(x) / 2，则n >= 2^bh(x) - 1 >= 2^(h(x)/2) - 1，通过公式推倒可知h(x) <= 2 × lg(n+1)

	所以，只要所有的操作能够维持红黑树的５种特性，那么树的高度就不会大于2 × lg(n+1)，即所有的操作都会在O(lg(n))时间内完成

#### 插入
	将要插入的节点标记为红色，按照搜索二叉树的插入方式将节点插入。此时可能会破坏红黑树的特性2和特性4。但是只会是其中的一个，如果破坏了特性2，是因为插入的是一个空树，此时不会破坏其他的特性。如果破坏了特性4，是因为他的父节点的颜色为红色，此时不会破坏其他的特性。恢复红黑特性的思想是：如果能在插入的位置通过一些操作恢复二叉树的性质，则直接操作，否则将插入的位置上升，直到根节点。如果到根节点，将颜色改为黑色。图中case2和case3可以直接恢复二叉树的特性，case1将位置上升。

#### 删除
	将要删除的节点按照搜索二叉树的删除方式将节点删除，但是要记录*删除的颜色*和所移动的子树x。如果删除的颜色为红色，则并不破坏红黑树的特性；如果删除的颜色为黑色，则可能会破坏红黑树的特性：如果要删除的节点为根节点，而x的颜色为红色，则破坏了特性1；如果x和x.p都为红色，则破坏了特性4；由于删除的颜色为黑色，则所有x的祖先的hb不再相等，破坏了特性5。

	恢复红黑树特性的主要思想为：将所删除的黑色留给x，如果能通过将多余的黑色补给一个红色的节点，并且能保持所有的红黑树特性，则直接操作，否则将x上升，直到根节点。如果到根节点则直接将黑色丢弃。图中case3和case4可以直接操作，case1变化为case2，case2将节点上升。
